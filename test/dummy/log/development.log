  [1m[36m (0.3ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
  [1m[36m (0.2ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
Migrating to AddScheduleFuTables (20120121210741)
  [1m[36m (0.2ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
Migrating to AddScheduleFuTables (20120121210741)
  [1m[36m (2.5ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
Migrating to AddScheduleFuTables (20120121210741)
  [1m[36m (0.1ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
Migrating to AddScheduleFuTables (20120121210741)
  [1m[35m (177.1ms)[0m  CREATE TABLE `calendars` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `desc` text) ENGINE=InnoDB
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `calendars` (`desc`) VALUES (NULL)
  [1m[36m (84.0ms)[0m  [1mCOMMIT[0m
  [1m[35m (165.7ms)[0m  CREATE TABLE `calendar_dates` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `value` date NOT NULL, `weekday` tinyint NOT NULL, `monthweek` tinyint NOT NULL, `monthday` tinyint NOT NULL, `month` tinyint NOT NULL, `lastweek` tinyint(1) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (322.6ms)[0m  [1mCREATE UNIQUE INDEX `index_calendar_dates_on_value` ON `calendar_dates` (`value`)[0m
  [1m[35m (166.4ms)[0m  CREATE TABLE `calendar_event_types` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `desc` varchar(255)) ENGINE=InnoDB
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Does not repeat', 'norepeat')
  [1m[36m (88.0ms)[0m  [1mCOMMIT[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Weekdays (M-F)', 'weekdays')[0m
  [1m[35m (52.8ms)[0m  COMMIT
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Daily', 'daily')
  [1m[36m (53.7ms)[0m  [1mCOMMIT[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Weekly', 'weekly')[0m
  [1m[35m (53.7ms)[0m  COMMIT
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Monthly', 'monthly')
  [1m[36m (53.7ms)[0m  [1mCOMMIT[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Yearly', 'yearly')[0m
  [1m[35m (53.3ms)[0m  COMMIT
  [1m[36m (255.7ms)[0m  [1mCREATE TABLE `calendar_events` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `calendar_id` int(11) NOT NULL, `calendar_event_type_id` int(11), `by_day_of_month` tinyint(1) DEFAULT 0 NOT NULL, `start_date` date, `end_date` date, `start_time` time, `end_time` time, `desc` text, `long_desc` text) ENGINE=InnoDB[0m
  [1m[35m (189.8ms)[0m  CREATE TABLE `calendar_event_mods` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `calendar_event_id` int(11) NOT NULL, `calendar_date_id` int(11) NOT NULL, `start_time` time, `end_time` time, `desc` text, `long_desc` text, `removed` tinyint(1) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (311.7ms)[0m  [1mCREATE UNIQUE INDEX `calendar_event_mods_for_event_and_date` ON `calendar_event_mods` (`calendar_event_id`, `calendar_date_id`)[0m
  [1m[35m (166.2ms)[0m  CREATE TABLE `calendar_recurrences` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `calendar_event_id` int(11) NOT NULL, `weekday` tinyint, `monthweek` tinyint, `monthday` tinyint, `month` tinyint) ENGINE=InnoDB
  [1m[36m (122.4ms)[0m  [1m CREATE VIEW calendar_event_dates AS
 SELECT
 ce.id 
 AS calendar_event_id,
 cd.id 
 AS calendar_date_id,
 cem.id
 AS calendar_event_mod_id,
 cd.value 
 AS date_value,
 COALESCE(cem.start_time, ce.start_time) 
 AS start_time,
 COALESCE(cem.end_time, ce.end_time) 
 AS end_time,
 COALESCE(cem.desc, ce.desc) 
 AS 'desc',
 COALESCE(cem.long_desc, ce.long_desc) 
 AS long_desc,
 ((ce.calendar_event_type_id IN (4,5,6) AND cr.id IS NULL)
 OR (ce.start_date IS NOT NULL AND cd.value < ce.start_date)
 OR (ce.end_date IS NOT NULL AND cd.value > ce.end_date)
 OR (ce.calendar_event_type_id = 2 AND cd.weekday not in (1,2,3,4,5)))
 AS added,
 (cem.id IS NOT NULL AND cem.removed = true) 
 AS removed,
 (cem.id IS NOT NULL AND cem.removed = false AND
 (cem.start_time IS NOT NULL OR cem.end_time IS NOT NULL
 OR cem.desc IS NOT NULL OR cem.long_desc IS NOT NULL))
 AS modified
 FROM calendar_dates cd
 LEFT OUTER JOIN calendar_events ce ON
 (ce.start_date IS NULL OR ce.start_date IS NOT NULL)
 LEFT OUTER JOIN calendar_event_mods cem
 ON cem.calendar_date_id = cd.id 
 AND cem.calendar_event_id = ce.id
 LEFT OUTER JOIN calendar_recurrences cr ON cr.calendar_event_id = ce.id
 AND ce.calendar_event_type_id IN (4,5,6)
 WHERE 
 (
 cd.id IS NOT NULL OR cem.id IS NOT NULL 
 ) AND (
 ((ce.start_date IS NULL OR cd.value >= ce.start_date)
 AND (ce.end_date IS NULL OR cd.value <= ce.end_date))
 OR cem.id IS NOT NULL
 ) AND (
 cem.id IS NOT NULL 
 OR (
 ce.calendar_event_type_id = 1 
 AND ce.start_date = cd.value
 ) OR (
 ce.calendar_event_type_id = 2 AND cd.weekday IN (1,2,3,4,5)
 ) OR (
 ce.calendar_event_type_id = 3
 ) OR (
 ce.calendar_event_type_id = 4 
 AND cr.weekday = cd.weekday
 ) OR (
 ce.calendar_event_type_id = 5
 AND (
 
 (
 ce.by_day_of_month = false 
 AND cr.weekday = cd.weekday
 AND (
 cr.monthweek = cd.monthweek
 OR (
 cr.monthweek = -1
 AND cd.lastweek = true
 )
 )
 ) OR (
 ce.by_day_of_month = true AND cr.monthday = cd.monthday
 )
 
 ) OR (
 ce.calendar_event_type_id = 6
 AND cd.month = cr.month 
 AND (
 
 (
 ce.by_day_of_month = false 
 AND cr.weekday = cd.weekday
 AND (
 cr.monthweek = cd.monthweek
 OR (
 cr.monthweek = -1
 AND cd.lastweek = true
 )
 )
 ) OR (
 ce.by_day_of_month = true AND cr.monthday = cd.monthday
 )
 
 )
 )
 )
 );
[0m
  [1m[35m (55.1ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20120121210741')
  [1m[36m (0.2ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
  [1m[36m (0.1ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
  [1m[35m (0.1ms)[0m  SELECT `schema_migrations`.`version` FROM `schema_migrations` 
Migrating to AddScheduleFuTables (20120121210741)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW calendar_event_dates[0m
  [1m[35m (59.9ms)[0m  DROP TABLE `calendar_recurrences`
  [1m[36m (77.7ms)[0m  [1mDROP TABLE `calendar_event_mods`[0m
  [1m[35m (68.3ms)[0m  DROP TABLE `calendar_events`
  [1m[36m (66.8ms)[0m  [1mDROP TABLE `calendar_event_types`[0m
  [1m[35m (332.1ms)[0m  DROP INDEX `index_calendar_dates_on_value` ON `calendar_dates`
  [1m[36m (66.3ms)[0m  [1mDROP TABLE `calendar_dates`[0m
  [1m[35m (66.9ms)[0m  DROP TABLE `calendars`
  [1m[36m (66.1ms)[0m  [1mDELETE FROM `schema_migrations` WHERE `schema_migrations`.`version` = '20120121210741'[0m
  [1m[35m (0.3ms)[0m  SELECT `schema_migrations`.`version` FROM `schema_migrations` 
  [1m[36m (0.1ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
  [1m[36m (0.1ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
Migrating to AddScheduleFuTables (20120121220057)
  [1m[35m (204.5ms)[0m  CREATE TABLE `calendars` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `desc` text) ENGINE=InnoDB
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `calendars` (`desc`) VALUES (NULL)
  [1m[36m (93.1ms)[0m  [1mCOMMIT[0m
  [1m[35m (165.4ms)[0m  CREATE TABLE `calendar_dates` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `value` date NOT NULL, `weekday` tinyint NOT NULL, `monthweek` tinyint NOT NULL, `monthday` tinyint NOT NULL, `month` tinyint NOT NULL, `lastweek` tinyint(1) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (311.5ms)[0m  [1mCREATE UNIQUE INDEX `index_calendar_dates_on_value` ON `calendar_dates` (`value`)[0m
  [1m[35m (155.1ms)[0m  CREATE TABLE `calendar_event_types` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `name` varchar(255), `desc` varchar(255)) ENGINE=InnoDB
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Does not repeat', 'norepeat')
  [1m[36m (74.8ms)[0m  [1mCOMMIT[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Weekdays (M-F)', 'weekdays')[0m
  [1m[35m (41.7ms)[0m  COMMIT
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Daily', 'daily')
  [1m[36m (42.5ms)[0m  [1mCOMMIT[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Weekly', 'weekly')[0m
  [1m[35m (42.7ms)[0m  COMMIT
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Monthly', 'monthly')
  [1m[36m (42.5ms)[0m  [1mCOMMIT[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `calendar_event_types` (`desc`, `name`) VALUES ('Yearly', 'yearly')[0m
  [1m[35m (42.6ms)[0m  COMMIT
  [1m[36m (154.9ms)[0m  [1mCREATE TABLE `calendar_events` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `calendar_id` int(11) NOT NULL, `calendar_event_type_id` int(11), `by_day_of_month` tinyint(1) DEFAULT 0 NOT NULL, `start_date` date, `end_date` date, `start_time` time, `end_time` time, `desc` text, `long_desc` text) ENGINE=InnoDB[0m
  [1m[35m (156.6ms)[0m  CREATE TABLE `calendar_event_mods` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `calendar_event_id` int(11) NOT NULL, `calendar_date_id` int(11) NOT NULL, `start_time` time, `end_time` time, `desc` text, `long_desc` text, `removed` tinyint(1) DEFAULT 0 NOT NULL) ENGINE=InnoDB
  [1m[36m (322.7ms)[0m  [1mCREATE UNIQUE INDEX `calendar_event_mods_for_event_and_date` ON `calendar_event_mods` (`calendar_event_id`, `calendar_date_id`)[0m
  [1m[35m (144.1ms)[0m  CREATE TABLE `calendar_recurrences` (`id` int(11) DEFAULT NULL auto_increment PRIMARY KEY, `calendar_event_id` int(11) NOT NULL, `weekday` tinyint, `monthweek` tinyint, `monthday` tinyint, `month` tinyint) ENGINE=InnoDB
  [1m[36m (44.7ms)[0m  [1m CREATE VIEW calendar_event_dates AS
 SELECT
 ce.id 
 AS calendar_event_id,
 cd.id 
 AS calendar_date_id,
 cem.id
 AS calendar_event_mod_id,
 cd.value 
 AS date_value,
 COALESCE(cem.start_time, ce.start_time) 
 AS start_time,
 COALESCE(cem.end_time, ce.end_time) 
 AS end_time,
 COALESCE(cem.desc, ce.desc) 
 AS 'desc',
 COALESCE(cem.long_desc, ce.long_desc) 
 AS long_desc,
 ((ce.calendar_event_type_id IN (4,5,6) AND cr.id IS NULL)
 OR (ce.start_date IS NOT NULL AND cd.value < ce.start_date)
 OR (ce.end_date IS NOT NULL AND cd.value > ce.end_date)
 OR (ce.calendar_event_type_id = 2 AND cd.weekday not in (1,2,3,4,5)))
 AS added,
 (cem.id IS NOT NULL AND cem.removed = true) 
 AS removed,
 (cem.id IS NOT NULL AND cem.removed = false AND
 (cem.start_time IS NOT NULL OR cem.end_time IS NOT NULL
 OR cem.desc IS NOT NULL OR cem.long_desc IS NOT NULL))
 AS modified
 FROM calendar_dates cd
 LEFT OUTER JOIN calendar_events ce ON
 (ce.start_date IS NULL OR ce.start_date IS NOT NULL)
 LEFT OUTER JOIN calendar_event_mods cem
 ON cem.calendar_date_id = cd.id 
 AND cem.calendar_event_id = ce.id
 LEFT OUTER JOIN calendar_recurrences cr ON cr.calendar_event_id = ce.id
 AND ce.calendar_event_type_id IN (4,5,6)
 WHERE 
 (
 cd.id IS NOT NULL OR cem.id IS NOT NULL 
 ) AND (
 ((ce.start_date IS NULL OR cd.value >= ce.start_date)
 AND (ce.end_date IS NULL OR cd.value <= ce.end_date))
 OR cem.id IS NOT NULL
 ) AND (
 cem.id IS NOT NULL 
 OR (
 ce.calendar_event_type_id = 1 
 AND ce.start_date = cd.value
 ) OR (
 ce.calendar_event_type_id = 2 AND cd.weekday IN (1,2,3,4,5)
 ) OR (
 ce.calendar_event_type_id = 3
 ) OR (
 ce.calendar_event_type_id = 4 
 AND cr.weekday = cd.weekday
 ) OR (
 ce.calendar_event_type_id = 5
 AND (
 
 (
 ce.by_day_of_month = false 
 AND cr.weekday = cd.weekday
 AND (
 cr.monthweek = cd.monthweek
 OR (
 cr.monthweek = -1
 AND cd.lastweek = true
 )
 )
 ) OR (
 ce.by_day_of_month = true AND cr.monthday = cd.monthday
 )
 
 ) OR (
 ce.calendar_event_type_id = 6
 AND cd.month = cr.month 
 AND (
 
 (
 ce.by_day_of_month = false 
 AND cr.weekday = cd.weekday
 AND (
 cr.monthweek = cd.monthweek
 OR (
 cr.monthweek = -1
 AND cd.lastweek = true
 )
 )
 ) OR (
 ce.by_day_of_month = true AND cr.monthday = cd.monthday
 )
 
 )
 )
 )
 );
[0m
  [1m[35m (77.2ms)[0m  INSERT INTO `schema_migrations` (`version`) VALUES ('20120121220057')
  [1m[36m (0.2ms)[0m  [1mSELECT `schema_migrations`.`version` FROM `schema_migrations` [0m
